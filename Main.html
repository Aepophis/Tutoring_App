<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <title>Tutoring Tracker v4 with Tabs</title>
  <style>
    /* Reset & base */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #eef2f7;
      margin: 0; padding: 20px;
      color: #333;
      min-height: 100vh;
    }

    /* Tabs container */
    #mainTabs {
      display: flex;
      border-bottom: 2px solid #ddd;
      margin-bottom: 20px;
      user-select: none;
    }
    #mainTabs button {
      background: none;
      border: none;
      padding: 12px 20px;
      font-size: 16px;
      font-weight: 600;
      color: #555;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: color 0.3s, border-color 0.3s;
    }
    #mainTabs button:hover,
    #mainTabs button:focus {
      color: #2980b9;
      outline: none;
    }
    #mainTabs button.active {
      color: #2980b9;
      border-bottom-color: #2980b9;
    }

    /* Panels */
    .panel {
      display: none;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
      min-height: 500px;
      /* Using flex inside panels as per original */
      display: flex;
      flex-direction: column;
      gap: 15px;
      outline: none;
    }
    .panel.active {
      display: flex;
    }

    /* Headings */
    h2 {
      margin-top: 0;
      color: #2c3e50;
      margin-bottom: 15px;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    /* Inputs and buttons */
    input, select, textarea {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      margin-bottom: 12px;
      font-size: 14px;
      transition: border-color 0.3s ease;
      resize: vertical;
      font-family: inherit;
    }
    input:focus, select:focus, textarea:focus {
      border-color: #3498db;
      outline: none;
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover {
      background: #2980b9;
    }
    button:active {
      background: #1c5980;
    }

    /* Student List */
    #studentList {
      overflow-y: auto;
      max-height: 300px;
      margin-bottom: 15px;
    }
    .student-entry {
      background: #f4f8fb;
      padding: 12px 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    .student-entry:hover {
      background-color: #d0e6fb;
    }
    .student-entry.selected {
      background-color: #3498db;
      color: white;
      box-shadow: 0 0 8px #2980b9aa;
    }
    .student-entry strong {
      color: inherit;
    }

    /* Student form */
    #studentForm {
      display: flex;
      flex-direction: column;
    }
    #studentForm input {
      margin-bottom: 10px;
    }
    #studentForm label {
      font-weight: 600;
      margin-bottom: 4px;
      color: #34495e;
    }
    #studentForm button {
      margin-top: 10px;
      align-self: flex-start;
    }

    /* Calendar Panel */
    #calendarPanel {
      max-width: 600px;
      min-width: 350px;
      flex-grow: 2;
      display: flex;
      flex-direction: column;
    }
    #calendarHeader {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    #calendarHeader button {
      width: 40px;
      padding: 5px;
      font-weight: 700;
      font-size: 18px;
      line-height: 1;
    }
    #monthYear {
      font-size: 20px;
      font-weight: 700;
      color: #34495e;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }
    .calendar-grid .day-name {
      font-weight: 700;
      text-align: center;
      padding: 6px 0;
      color: #7f8c8d;
      user-select: none;
    }
    .calendar-grid .day {
      background: white;
      padding: 12px 0;
      text-align: center;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      transition: background-color 0.3s ease, color 0.3s ease;
      user-select: none;
    }
    .calendar-grid .day:hover {
      background: #3498db;
      color: white;
    }
    .calendar-grid .day.selected {
      background: #2980b9;
      color: white;
      box-shadow: 0 0 10px #2980b9aa;
    }
    .calendar-grid .day.inactive {
      color: #bdc3c7;
      cursor: default;
      background: transparent;
      box-shadow: none;
    }

    #selectedDate {
      margin-top: 12px;
      font-weight: 700;
      font-size: 16px;
      color: #34495e;
      min-height: 24px;
      user-select: none;
    }

    #calendarNote {
      margin-top: 10px;
      flex-grow: 1;
      font-size: 14px;
      border-radius: 10px;
      min-height: 100px;
      font-family: inherit;
    }

    /* Notes / Resources / Syllabuses */
    #notePanel {
      max-width: 600px;
      min-width: 350px;
    }
    .tabs {
      display: flex;
      margin-bottom: 10px;
      border-bottom: 2px solid #ddd;
    }
    .tab {
      flex-grow: 1;
      text-align: center;
      padding: 10px 0;
      font-weight: 700;
      cursor: pointer;
      border-radius: 8px 8px 0 0;
      background: #f0f3f7;
      color: #7f8c8d;
      user-select: none;
      transition: background-color 0.3s ease;
      border: 1px solid transparent;
      border-bottom: none;
    }
    .tab.active {
      background: white;
      color: #2980b9;
      border-color: #ccc #ccc white #ccc;
      box-shadow: 0 -3px 10px -2px #2980b9aa;
    }
    textarea {
      flex-grow: 1;
      min-height: 250px;
      font-size: 14px;
      border-radius: 10px;
      font-family: inherit;
    }

    /* Resources editor container */
    #resourcesEditorContainer {
      display: none;
      flex-direction: column;
      height: 280px;
    }
    #resourcesEditor {
      flex-grow: 1;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 10px;
      font-family: inherit;
      overflow-y: auto;
      white-space: pre-wrap;
      outline: none;
      cursor: text;
    }
    #resourcesLinks a {
      display: block;
      color: #3498db;
      margin-bottom: 6px;
      text-decoration: underline;
      cursor: pointer;
      user-select: text;
    }

    /* Student Profile */
    #studentProfilePanel p {
      margin: 4px 0;
      font-size: 15px;
    }
    #studentProfilePanel strong {
      color: #2980b9;
    }

    /* Logbook */
    #logEntries h3 {
      margin-top: 0;
    }
    #logList li {
      margin-bottom: 10px;
    }
    #logbookPanel form > * {
      margin-bottom: 12px;
    }
  </style>
</head>
<body>

  <!-- MAIN TABS -->
  <nav id="mainTabs" role="tablist" aria-label="Main Sections">
    <button id="tabStudents" aria-controls="studentPanel" role="tab" aria-selected="true" tabindex="0" class="active">Students</button>
    <button id="tabCalendar" aria-controls="calendarPanel" role="tab" aria-selected="false" tabindex="-1">Calendar</button>
    <button id="tabNotes" aria-controls="notePanel" role="tab" aria-selected="false" tabindex="-1">Notes & Resources</button>
    <button id="tabProfile" aria-controls="studentProfilePanel" role="tab" aria-selected="false" tabindex="-1">Student Profile</button>
    <button id="tabLogbook" aria-controls="logbookPanel" role="tab" aria-selected="false" tabindex="-1">Logbook</button>
  </nav>

  <!-- PANELS -->
  <main id="contentArea">
    <!-- STUDENTS -->
    <section id="studentPanel" class="panel active" role="tabpanel" tabindex="0" aria-labelledby="tabStudents">
      <h2>Students</h2>
      <div id="studentList" aria-live="polite" aria-label="Student list"></div>

      <form id="studentForm" aria-label="Student detail form" onsubmit="return false;">
        <label for="inputName">Name</label>
        <input id="inputName" type="text" autocomplete="off" placeholder="Student name" required />

        <label for="inputParents">Parents' Names</label>
        <input id="inputParents" type="text" autocomplete="off" placeholder="Parents' full names" />

        <label for="inputAddress">Home Address</label>
        <input id="inputAddress" type="text" autocomplete="off" placeholder="Home address" />

        <label for="inputContact">Email / Phone Number</label>
        <input id="inputContact" type="text" autocomplete="off" placeholder="Email or phone" />

        <label for="inputGrade">Grade / Year</label>
        <input id="inputGrade" type="text" autocomplete="off" placeholder="Grade or Year level" />

        <label for="inputProficiency">Proficiency</label>
        <input id="inputProficiency" type="text" autocomplete="off" placeholder="Proficiency level (e.g. Beginner)" />

        <label for="inputPayment">Payment per Lesson</label>
        <input id="inputPayment" type="text" autocomplete="off" placeholder="Payment amount" />

        <label for="inputSubject">Subject(s) Learning</label>
        <input id="inputSubject" type="text" autocomplete="off" placeholder="Subject(s)" />

        <button id="saveStudentBtn" type="submit">Save Student</button>
        <button id="newStudentBtn" type="button" style="background:#7f8c8d; margin-top: 5px;">Add New Student</button>
        <button id="deleteStudentBtn" type="button" style="background:#e74c3c; margin-top: 5px; display:none;">Delete Student</button>
      </form>
    </section>

    <!-- CALENDAR -->
    <section id="calendarPanel" class="panel" role="tabpanel" tabindex="0" aria-labelledby="tabCalendar">
      <h2>Session Calendar</h2>
      <div id="calendarHeader">
        <button id="prevMonthBtn" aria-label="Previous Month">&lt;</button>
        <div id="monthYear" aria-live="polite"></div>
        <button id="nextMonthBtn" aria-label="Next Month">&gt;</button>
      </div>
      <div class="calendar-grid" id="calendarGrid" role="grid" aria-label="Calendar days">
        <!-- Days injected here -->
      </div>
      <div id="selectedDate" aria-live="polite">Select a date</div>
      <textarea id="calendarNote" placeholder="Notes for selected date..."></textarea>
      <button id="saveCalendarNoteBtn">Save Note</button>
    </section>

    <!-- NOTES / RESOURCES / SYLLABUSES -->
    <section id="notePanel" class="panel" role="tabpanel" tabindex="0" aria-labelledby="tabNotes">
      <h2>Notes & Resources</h2>
      <div class="tabs" role="tablist">
        <div class="tab active" role="tab" aria-selected="true" tabindex="0" data-tab="notes">Notes</div>
        <div class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="resources">Resources</div>
        <div class="tab" role="tab" aria-selected="false" tabindex="-1" data-tab="syllabuses">Syllabuses</div>
      </div>

      <textarea id="tabNotes" placeholder="Paste lesson notes here..."></textarea>

      <div id="resourcesEditorContainer">
        <div id="resourcesEditor" contenteditable="true" aria-label="Resources editor"></div>
        <button id="toggleResourcesViewBtn" style="margin-top:8px; width: 150px;">View Links</button>
        <div id="resourcesLinks" style="margin-top: 10px; max-height: 150px; overflow-y: auto;" aria-live="polite"></div>
      </div>

      <textarea id="tabSyllabuses" style="display:none;" placeholder="Paste syllabuses here..."></textarea>
      <button id="saveNotesBtn">Save</button>
    </section>

    <!-- STUDENT PROFILE -->
    <section id="studentProfilePanel" class="panel" role="tabpanel" tabindex="0" aria-labelledby="tabProfile" style="display:none;">
      <h2>Student Profile</h2>
      <div id="studentProfileContent">
        <p><strong>Name:</strong> <span id="profileName"></span></p>
        <p><strong>Parents:</strong> <span id="profileParents"></span></p>
        <p><strong>Address:</strong> <span id="profileAddress"></span></p>
        <p><strong>Contact:</strong> <span id="profileContact"></span></p>
        <p><strong>Grade:</strong> <span id="profileGrade"></span></p>
        <p><strong>Proficiency:</strong> <span id="profileProficiency"></span></p>
        <p><strong>Payment:</strong> <span id="profilePayment"></span></p>
        <p><strong>Subjects:</strong> <span id="profileSubject"></span></p>
      </div>
    </section>

    <!-- LOGBOOK -->
    <section id="logbookPanel" class="panel" role="tabpanel" tabindex="0" aria-labelledby="tabLogbook">
      <h2>Logbook</h2>
      <form id="logEntryForm" onsubmit="return false;">
        <label for="logType">Type of Entry</label>
        <select id="logType" required>
          <option value="">Select Type...</option>
          <option>New Student</option>
          <option>Student Left</option>
          <option>Incident</option>
          <option>General Note</option>
          <option>Schedule Change</option>
          <option>Parent Communication</option>
          <option>Session Summary</option>
        </select>

        <label for="logStudent">Student</label>
        <select id="logStudent">
          <option value="">Select Student (optional)...</option>
        </select>

        <label for="logDate">Date</label>
        <input id="logDate" type="date" required />

        <label for="logDetails">Details</label>
        <textarea id="logDetails" placeholder="Describe what happened or session summary..." required></textarea>

        <button type="submit">Add Log Entry</button>
      </form>

      <div id="logEntries" style="margin-top: 20px; max-height: 300px; overflow-y: auto;">
        <h3>Previous Entries</h3>
        <ul id="logList" style="padding-left: 20px;"></ul>
      </div>
    </section>
  </main>

  <script>
    // --- TAB SWITCHING FOR MAIN PANELS ---
    const tabs = document.querySelectorAll('#mainTabs button');
    const panels = document.querySelectorAll('#contentArea .panel');

    tabs.forEach((tab, index) => {
      tab.addEventListener('click', () => {
        activateTab(index);
      });

      tab.addEventListener('keydown', e => {
        let newIndex = null;
        if (e.key === 'ArrowRight') {
          newIndex = (index + 1) % tabs.length;
        } else if (e.key === 'ArrowLeft') {
          newIndex = (index - 1 + tabs.length) % tabs.length;
        } else if (e.key === 'Home') {
          newIndex = 0;
        } else if (e.key === 'End') {
          newIndex = tabs.length - 1;
        } else if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          activateTab(index);
        }
        if (newIndex !== null) {
          e.preventDefault();
          tabs[newIndex].focus();
        }
      });
    });

    function activateTab(activeIndex) {
      tabs.forEach((tab, i) => {
        const selected = i === activeIndex;
        tab.classList.toggle('active', selected);
        tab.setAttribute('aria-selected', selected);
        tab.setAttribute('tabindex', selected ? '0' : '-1');
        panels[i].classList.toggle('active', selected);
        if (selected) panels[i].focus();
      });
      // When switching tabs, clear calendar selected date to avoid confusion
      if (activeIndex === 1) {
        if (!selectedDate) {
          selectDate(new Date());
        }
      }
    }

    activateTab(0); // Start on Students tab

    // --- STUDENTS ---
    const studentListDiv = document.getElementById('studentList');
    const studentForm = document.getElementById('studentForm');
    const saveStudentBtn = document.getElementById('saveStudentBtn');
    const newStudentBtn = document.getElementById('newStudentBtn');
    const deleteStudentBtn = document.getElementById('deleteStudentBtn');

    const inputs = {
      name: document.getElementById('inputName'),
      parents: document.getElementById('inputParents'),
      address: document.getElementById('inputAddress'),
      contact: document.getElementById('inputContact'),
      grade: document.getElementById('inputGrade'),
      proficiency: document.getElementById('inputProficiency'),
      payment: document.getElementById('inputPayment'),
      subject: document.getElementById('inputSubject'),
    };

    let students = JSON.parse(localStorage.getItem('students') || '[]');
    let selectedStudentIndex = null;

    function saveStudentsToStorage() {
      localStorage.setItem('students', JSON.stringify(students));
    }

    function renderStudents() {
      studentListDiv.innerHTML = '';
      students.forEach((stu, i) => {
        const div = document.createElement('div');
        div.className = 'student-entry' + (i === selectedStudentIndex ? ' selected' : '');
        div.tabIndex = 0;
        div.setAttribute('role', 'button');
        div.setAttribute('aria-pressed', i === selectedStudentIndex ? 'true' : 'false');
        div.innerHTML = `<strong>${stu.name}</strong> - Grade ${stu.grade}`;
        div.addEventListener('click', () => selectStudent(i));
        div.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectStudent(i);
          }
        });
        studentListDiv.appendChild(div);
      });
      populateLogStudentDropdown();
    }

    function selectStudent(index) {
      selectedStudentIndex = index;
      const stu = students[index];
      inputs.name.value = stu.name;
      inputs.parents.value = stu.parents;
      inputs.address.value = stu.address;
      inputs.contact.value = stu.contact;
      inputs.grade.value = stu.grade;
      inputs.proficiency.value = stu.proficiency;
      inputs.payment.value = stu.payment;
      inputs.subject.value = stu.subject;

      deleteStudentBtn.style.display = 'inline-block';
      renderStudents();
      updateStudentProfilePanel(stu);
      activateTab(3); // Automatically switch to Profile tab on select
    }

    function clearStudentForm() {
      selectedStudentIndex = null;
      for (const key in inputs) {
        inputs[key].value = '';
      }
      deleteStudentBtn.style.display = 'none';
      renderStudents();
      clearStudentProfilePanel();
    }

    saveStudentBtn.addEventListener('click', () => {
      const newStudent = {
        name: inputs.name.value.trim(),
        parents: inputs.parents.value.trim(),
        address: inputs.address.value.trim(),
        contact: inputs.contact.value.trim(),
        grade: inputs.grade.value.trim(),
        proficiency: inputs.proficiency.value.trim(),
        payment: inputs.payment.value.trim(),
        subject: inputs.subject.value.trim(),
      };
      if (!newStudent.name) {
        alert('Student name is required!');
        return;
      }
      if (selectedStudentIndex !== null) {
        students[selectedStudentIndex] = newStudent;
      } else {
        students.push(newStudent);
      }
      saveStudentsToStorage();
      renderStudents();
      clearStudentForm();
      alert('Student saved!');
    });

    newStudentBtn.addEventListener('click', () => {
      clearStudentForm();
      activateTab(0);
    });

    deleteStudentBtn.addEventListener('click', () => {
      if (selectedStudentIndex !== null) {
        if (confirm(`Delete student "${students[selectedStudentIndex].name}"?`)) {
          students.splice(selectedStudentIndex, 1);
          saveStudentsToStorage();
          clearStudentForm();
          alert('Student deleted!');
        }
      }
    });

    function updateStudentProfilePanel(student) {
      if (!student) return clearStudentProfilePanel();
      document.getElementById('profileName').textContent = student.name || '';
      document.getElementById('profileParents').textContent = student.parents || '';
      document.getElementById('profileAddress').textContent = student.address || '';
      document.getElementById('profileContact').textContent = student.contact || '';
      document.getElementById('profileGrade').textContent = student.grade || '';
      document.getElementById('profileProficiency').textContent = student.proficiency || '';
      document.getElementById('profilePayment').textContent = student.payment || '';
      document.getElementById('profileSubject').textContent = student.subject || '';
    }
    function clearStudentProfilePanel() {
      updateStudentProfilePanel({
        name: '',
        parents: '',
        address: '',
        contact: '',
        grade: '',
        proficiency: '',
        payment: '',
        subject: '',
      });
    }

    // --- CALENDAR ---

    const calendarGrid = document.getElementById('calendarGrid');
    const monthYearLabel = document.getElementById('monthYear');
    const prevMonthBtn = document.getElementById('prevMonthBtn');
    const nextMonthBtn = document.getElementById('nextMonthBtn');
    const selectedDateDiv = document.getElementById('selectedDate');
    const calendarNoteTextarea = document.getElementById('calendarNote');
    const saveCalendarNoteBtn = document.getElementById('saveCalendarNoteBtn');

    let currentDate = new Date();
    let selectedDate = null;
    let calendarNotes = JSON.parse(localStorage.getItem('calendarNotes') || '{}');

    function renderCalendar(year, month) {
      calendarGrid.innerHTML = '';
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDayOfWeek = firstDay.getDay(); // Sunday=0, Monday=1...
      const daysInMonth = lastDay.getDate();

      // Show month-year
      const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
      ];
      monthYearLabel.textContent = `${monthNames[month]} ${year}`;

      // Weekday headers
      const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      dayNames.forEach(dayName => {
        const div = document.createElement('div');
        div.className = 'day-name';
        div.textContent = dayName;
        calendarGrid.appendChild(div);
      });

      // Fill in blank days before month start
      for (let i = 0; i < startDayOfWeek; i++) {
        const blank = document.createElement('div');
        blank.className = 'day inactive';
        blank.textContent = '';
        calendarGrid.appendChild(blank);
      }

      // Add day cells
      for (let day = 1; day <= daysInMonth; day++) {
        const dayCell = document.createElement('div');
        dayCell.className = 'day';
        dayCell.textContent = day;
        dayCell.tabIndex = 0;
        dayCell.setAttribute('role', 'button');
        dayCell.setAttribute('aria-label', `${monthNames[month]} ${day}, ${year}`);
        const dateStr = `${year}-${(month+1).toString().padStart(2,'0')}-${day.toString().padStart(2,'0')}`;

        if (selectedDate === dateStr) {
          dayCell.classList.add('selected');
        }

        dayCell.addEventListener('click', () => {
          selectDate(new Date(year, month, day));
        });
        dayCell.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            selectDate(new Date(year, month, day));
          }
        });
        calendarGrid.appendChild(dayCell);
      }
    }

    function selectDate(date) {
      selectedDate = date.toISOString().split('T')[0];
      renderCalendar(date.getFullYear(), date.getMonth());
      selectedDateDiv.textContent = `Selected: ${date.toDateString()}`;
      calendarNoteTextarea.value = calendarNotes[selectedDate] || '';
    }

    prevMonthBtn.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
      selectedDate = null;
      selectedDateDiv.textContent = 'Select a date';
      calendarNoteTextarea.value = '';
    });

    nextMonthBtn.addEventListener('click', () => {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
      selectedDate = null;
      selectedDateDiv.textContent = 'Select a date';
      calendarNoteTextarea.value = '';
    });

    saveCalendarNoteBtn.addEventListener('click', () => {
      if (!selectedDate) {
        alert('Please select a date first.');
        return;
      }
      calendarNotes[selectedDate] = calendarNoteTextarea.value.trim();
      localStorage.setItem('calendarNotes', JSON.stringify(calendarNotes));
      alert('Note saved!');
    });

    // On load show current month & date
    window.addEventListener('load', () => {
      currentDate = new Date();
      renderCalendar(currentDate.getFullYear(), currentDate.getMonth());
      selectDate(currentDate);
    });

    // --- NOTES / RESOURCES / SYLLABUSES ---
    const noteTabs = document.querySelectorAll('#notePanel .tabs .tab');
    const tabNotesTextarea = document.getElementById('tabNotes');
    const resourcesEditorContainer = document.getElementById('resourcesEditorContainer');
    const resourcesEditor = document.getElementById('resourcesEditor');
    const resourcesLinksDiv = document.getElementById('resourcesLinks');
    const toggleResourcesViewBtn = document.getElementById('toggleResourcesViewBtn');
    const tabSyllabusesTextarea = document.getElementById('tabSyllabuses');
    const saveNotesBtn = document.getElementById('saveNotesBtn');

    // Storage keys for notes/resources/syllabuses
    let notesData = localStorage.getItem('notes') || '';
    let resourcesData = localStorage.getItem('resources') || '';
    let syllabusesData = localStorage.getItem('syllabuses') || '';

    // Init content
    tabNotesTextarea.value = notesData;
    resourcesEditor.innerText = resourcesData;
    tabSyllabusesTextarea.value = syllabusesData;

    // Show only the active note tab content
    noteTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        noteTabs.forEach(t => {
          const selected = t === tab;
          t.classList.toggle('active', selected);
          t.setAttribute('aria-selected', selected);
          t.setAttribute('tabindex', selected ? '0' : '-1');
        });

        const type = tab.dataset.tab;
        if (type === 'notes') {
          tabNotesTextarea.style.display = 'block';
          resourcesEditorContainer.style.display = 'none';
          tabSyllabusesTextarea.style.display = 'none';
          toggleResourcesViewBtn.style.display = 'none';
        } else if (type === 'resources') {
          tabNotesTextarea.style.display = 'none';
          resourcesEditorContainer.style.display = 'flex';
          tabSyllabusesTextarea.style.display = 'none';
          toggleResourcesViewBtn.style.display = 'inline-block';
          showResourcesAsLinks(false);
        } else if (type === 'syllabuses') {
          tabNotesTextarea.style.display = 'none';
          resourcesEditorContainer.style.display = 'none';
          tabSyllabusesTextarea.style.display = 'block';
          toggleResourcesViewBtn.style.display = 'none';
        }
      });
    });

    // Toggle resources view as text editor or links
    let showingLinks = false;
    toggleResourcesViewBtn.addEventListener('click', () => {
      showingLinks = !showingLinks;
      showResourcesAsLinks(showingLinks);
      toggleResourcesViewBtn.textContent = showingLinks ? 'Edit Text' : 'View Links';
    });

    function showResourcesAsLinks(show) {
      if (show) {
        resourcesEditor.style.display = 'none';
        resourcesLinksDiv.style.display = 'block';
        renderResourceLinks(resourcesEditor.innerText);
      } else {
        resourcesEditor.style.display = 'block';
        resourcesLinksDiv.style.display = 'none';
      }
    }

    function renderResourceLinks(text) {
      resourcesLinksDiv.innerHTML = '';
      // Find all URLs in text using regex
      const urlRegex = /(https?:\/\/[^\s]+)/g;
      const matches = text.match(urlRegex);
      if (matches) {
        matches.forEach(url => {
          const a = document.createElement('a');
          a.href = url;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.textContent = url;
          resourcesLinksDiv.appendChild(a);
        });
      } else {
        resourcesLinksDiv.textContent = 'No URLs found in resources.';
      }
    }

    saveNotesBtn.addEventListener('click', () => {
      // Save whichever tab is active
      const activeTab = [...noteTabs].find(t => t.classList.contains('active'));
      if (!activeTab) return;
      if (activeTab.dataset.tab === 'notes') {
        notesData = tabNotesTextarea.value;
        localStorage.setItem('notes', notesData);
      } else if (activeTab.dataset.tab === 'resources') {
        resourcesData = resourcesEditor.innerText;
        localStorage.setItem('resources', resourcesData);
      } else if (activeTab.dataset.tab === 'syllabuses') {
        syllabusesData = tabSyllabusesTextarea.value;
        localStorage.setItem('syllabuses', syllabusesData);
      }
      alert('Saved!');
    });

    // --- LOGBOOK ---
    const logEntryForm = document.getElementById('logEntryForm');
    const logTypeSelect = document.getElementById('logType');
    const logStudentSelect = document.getElementById('logStudent');
    const logDateInput = document.getElementById('logDate');
    const logDetailsTextarea = document.getElementById('logDetails');
    const logListUl = document.getElementById('logList');

    let logEntries = JSON.parse(localStorage.getItem('logEntries') || '[]');

    function populateLogStudentDropdown() {
      logStudentSelect.innerHTML = '<option value="">Select Student (optional)...</option>';
      students.forEach(stu => {
        const opt = document.createElement('option');
        opt.value = stu.name;
        opt.textContent = stu.name;
        logStudentSelect.appendChild(opt);
      });
    }
    populateLogStudentDropdown();

    function renderLogEntries() {
      logListUl.innerHTML = '';
      if (logEntries.length === 0) {
        const li = document.createElement('li');
        li.textContent = 'No log entries yet.';
        logListUl.appendChild(li);
        return;
      }
      logEntries.slice().reverse().forEach(entry => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>${entry.date}</strong> — <em>${entry.type}</em> ${entry.student ? `for ${entry.student}` : ''}:<br>${entry.details}`;
        logListUl.appendChild(li);
      });
    }
    renderLogEntries();

    logEntryForm.addEventListener('submit', () => {
      const type = logTypeSelect.value;
      const date = logDateInput.value;
      const details = logDetailsTextarea.value.trim();
      const student = logStudentSelect.value;

      if (!type) {
        alert('Please select a log entry type.');
        return;
      }
      if (!date) {
        alert('Please select a date.');
        return;
      }
      if (!details) {
        alert('Please enter details.');
        return;
      }

      logEntries.push({ type, date, student, details });
      localStorage.setItem('logEntries', JSON.stringify(logEntries));
      renderLogEntries();

      logTypeSelect.value = '';
      logDateInput.value = '';
      logDetailsTextarea.value = '';
      logStudentSelect.value = '';

      alert('Log entry added!');
    });

    // Save students and log entries to storage on page unload (backup)
    window.addEventListener('beforeunload', () => {
      saveStudentsToStorage();
      localStorage.setItem('logEntries', JSON.stringify(logEntries));
      localStorage.setItem('notes', notesData);
      localStorage.setItem('resources', resourcesData);
      localStorage.setItem('syllabuses', syllabusesData);
      localStorage.setItem('calendarNotes', JSON.stringify(calendarNotes));
    });
  </script>
</body>
</html>
